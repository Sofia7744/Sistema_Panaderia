<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Métricas - Panadería Delicia</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .metric-card {
            transition: transform 0.2s;
            border-left: 4px solid #0d6efd;
        }
        .metric-card:hover {
            transform: translateY(-2px);
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        .filter-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
    </style>
</head>
<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/">
            <i class="fas fa-bread-slice"></i> Panadería Delicia
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/">Inicio</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/productos}">Productos</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/promociones}">Promociones</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="compraDropdown" role="button" data-bs-toggle="dropdown">
                        Compra
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" th:href="@{/nueva-compra}">Nueva Compra</a></li>
                        <li><a class="dropdown-item" th:href="@{/mis-compras}">Mis Compras</a></li>
                    </ul>
                </li>
                <!-- Menú para Personal -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle text-warning" href="#" id="gestionDropdown" role="button" data-bs-toggle="dropdown">
                        Gestión
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" th:href="@{/gestion-productos}">Productos</a></li>
                        <li><a class="dropdown-item" th:href="@{/gestion-categorias}">Categorías</a></li>
                        <li><a class="dropdown-item" th:href="@{/gestion-usuarios}">Usuarios</a></li>
                        <li><a class="dropdown-item" th:href="@{/gestion-compras}">Compras</a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a class="nav-link active text-info" th:href="@{/metricas}">Métricas</a>
                </li>
            </ul>
            <ul class="navbar-nav">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-user"></i> <span th:text="${usuario != null ? usuario.nombre : 'Personal'}">Personal</span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" th:href="@{/mi-perfil}">Mi Perfil</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#">Cerrar Sesión</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Contenido Principal -->
<div class="container mt-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1><i class="fas fa-chart-bar"></i> Métricas y Reportes</h1>
        <button class="btn btn-outline-primary" onclick="generarReportePDF()">
            <i class="fas fa-file-pdf"></i> Exportar PDF
        </button>
    </div>

    <!-- Filtros de Tiempo -->
    <div class="card filter-card mb-4">
        <div class="card-body">
            <h5 class="card-title text-white"><i class="fas fa-filter"></i> Filtros de Tiempo</h5>
            <div class="row g-3">
                <div class="col-md-3">
                    <label class="form-label text-white">Rango de Tiempo</label>
                    <select class="form-select" id="timeRange" onchange="actualizarMetricas()">
                        <option value="7">Últimos 7 días</option>
                        <option value="30" selected>Últimos 30 días</option>
                        <option value="90">Últimos 3 meses</option>
                        <option value="365">Último año</option>
                        <option value="custom">Personalizado</option>
                    </select>
                </div>
                <div class="col-md-3" id="customDateRange" style="display: none;">
                    <label class="form-label text-white">Fecha Inicio</label>
                    <input type="date" class="form-control" id="startDate">
                </div>
                <div class="col-md-3" id="customDateRangeEnd" style="display: none;">
                    <label class="form-label text-white">Fecha Fin</label>
                    <input type="date" class="form-control" id="endDate">
                </div>
                <div class="col-md-3 d-flex align-items-end">
                    <button class="btn btn-light w-100" onclick="aplicarFiltros()">
                        <i class="fas fa-sync-alt"></i> Aplicar Filtros
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tarjetas de Métricas -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card metric-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title text-muted">Productos Activos</h6>
                            <h2 th:text="${totalProductos}" class="text-primary">0</h2>
                            <small class="text-muted">
                                <span th:text="${productosInactivos}">0</span> inactivos
                            </small>
                        </div>
                        <i class="fas fa-box text-primary fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card metric-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title text-muted">Categorías Activas</h6>
                            <h2 th:text="${totalCategorias}" class="text-success">0</h2>
                            <small class="text-muted">
                                <span th:text="${categoriasInactivas}">0</span> inactivas
                            </small>
                        </div>
                        <i class="fas fa-tags text-success fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card metric-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title text-muted">Total Usuarios</h6>
                            <h2 th:text="${totalUsuarios}" class="text-warning">0</h2>
                            <small class="text-muted">Registrados en el sistema</small>
                        </div>
                        <i class="fas fa-users text-warning fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card metric-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title text-muted">Ventas del Mes</h6>
                            <h2 class="text-info">S/ 8,450</h2>
                            <small class="text-muted">+12% vs mes anterior</small>
                        </div>
                        <i class="fas fa-chart-line text-info fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Gráficos -->
    <div class="row">
        <!-- Gráfico 1: Ventas por Día -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-shopping-cart"></i> Ventas por Día - Últimos 7 días</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="ventasChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gráfico 2: Productos Más Vendidos -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-star"></i> Productos Más Vendidos</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="productosChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gráfico 3: Métrica Adicional 1 - Categorías -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-chart-pie"></i> Distribución por Categorías</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="categoriasChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gráfico 4: Métrica Adicional 2 - Tendencia -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-chart-line"></i> Tendencia de Ventas - Últimos 30 días</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="tendenciaChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabla de Resumen -->
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0"><i class="fas fa-table"></i> Resumen de Métricas</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>Indicador</th>
                        <th>Valor Actual</th>
                        <th>Variación</th>
                        <th>Tendencia</th>
                        <th>Meta</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>Ventas Totales</td>
                        <td>S/ 8,450</td>
                        <td><span class="text-success">+12%</span></td>
                        <td><i class="fas fa-arrow-up text-success"></i> Ascendente</td>
                        <td>S/ 10,000</td>
                    </tr>
                    <tr>
                        <td>Productos Vendidos</td>
                        <td>245 unidades</td>
                        <td><span class="text-success">+8%</span></td>
                        <td><i class="fas fa-arrow-up text-success"></i> Ascendente</td>
                        <td>300 unidades</td>
                    </tr>
                    <tr>
                        <td>Clientes Nuevos</td>
                        <td>45 clientes</td>
                        <td><span class="text-warning">+2%</span></td>
                        <td><i class="fas fa-minus text-warning"></i> Estable</td>
                        <td>60 clientes</td>
                    </tr>
                    <tr>
                        <td>Ticket Promedio</td>
                        <td>S/ 34.50</td>
                        <td><span class="text-success">+5%</span></td>
                        <td><i class="fas fa-arrow-up text-success"></i> Ascendente</td>
                        <td>S/ 40.00</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="bg-dark text-white py-4 mt-5">
    <div class="container text-center">
        <p>&copy; 2025 Panadería Delicia. Todos los derechos reservados.</p>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Mostrar/ocultar fechas personalizadas
    document.getElementById('timeRange').addEventListener('change', function() {
        const customRange = this.value === 'custom';
        document.getElementById('customDateRange').style.display = customRange ? 'block' : 'none';
        document.getElementById('customDateRangeEnd').style.display = customRange ? 'block' : 'none';
    });

    function aplicarFiltros() {
        const timeRange = document.getElementById('timeRange').value;
        alert('Aplicando filtros para: ' + (timeRange === 'custom' ? 'rango personalizado' : 'últimos ' + timeRange + ' días'));
        // En una app real, aquí se recargarían las métricas con los nuevos filtros
    }

    function generarReportePDF() {
        alert('Generando reporte PDF...\n\nEn una aplicación real, se generaría un PDF con todas las métricas actuales.');
    }

    function actualizarMetricas() {
        // Simulación de actualización de métricas según filtros
        console.log('Actualizando métricas con nuevos filtros...');
    }

    // Inicializar gráficos cuando el DOM esté listo
    document.addEventListener('DOMContentLoaded', function() {
        // Gráfico de Ventas por Día
        const ventasCtx = document.getElementById('ventasChart').getContext('2d');
        new Chart(ventasCtx, {
            type: 'bar',
            data: {
                labels: ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'],
                datasets: [{
                    label: 'Ventas (S/)',
                    data: [1200, 1900, 1500, 2100, 1800, 2500, 2200],
                    backgroundColor: 'rgba(54, 162, 235, 0.8)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return 'S/ ' + value;
                            }
                        }
                    }
                }
            }
        });

        // Gráfico de Productos Más Vendidos
        const productosCtx = document.getElementById('productosChart').getContext('2d');
        new Chart(productosCtx, {
            type: 'doughnut',
            data: {
                labels: ['Pan Francés', 'Baguette', 'Torta Chocolate', 'Croissants', 'Galletas'],
                datasets: [{
                    data: [35, 25, 20, 15, 5],
                    backgroundColor: [
                        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });

        // Gráfico de Categorías
        const categoriasCtx = document.getElementById('categoriasChart').getContext('2d');
        new Chart(categoriasCtx, {
            type: 'pie',
            data: {
                labels: ['Panes', 'Pasteles', 'Galletas', 'Bebidas'],
                datasets: [{
                    data: [45, 30, 15, 10],
                    backgroundColor: [
                        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });

        // Gráfico de Tendencia
        const tendenciaCtx = document.getElementById('tendenciaChart').getContext('2d');
        new Chart(tendenciaCtx, {
            type: 'line',
            data: {
                labels: ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4'],
                datasets: [{
                    label: 'Ventas Semanales (S/)',
                    data: [6500, 7200, 8000, 8450],
                    borderColor: '#4BC0C0',
                    backgroundColor: 'rgba(75, 192, 192, 0.1)',
                    borderWidth: 2,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false,
                        ticks: {
                            callback: function(value) {
                                return 'S/ ' + value;
                            }
                        }
                    }
                }
            }
        });
    });
</script>
</body>
</html>